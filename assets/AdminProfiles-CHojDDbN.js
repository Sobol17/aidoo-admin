import{s as ne}from"./index-B1O_roLE.js";import{s as de}from"./index-B5GLnlRG.js";import{s as ue}from"./index-DysR0UgT.js";import{s as me}from"./index-C0k0BVDM.js";import{s as fe}from"./index-C-zIenvA.js";import{s as pe}from"./index-BWWt08Hc.js";import{s as ce,a as ve}from"./index-CRMrgCsE.js";import{s as ye}from"./index-BOXa9Jy8.js";import{s as be}from"./index-CxNTl2I9.js";import{u as ge}from"./useAdminAccounts-Bctc6_nv.js";import{aW as D,aR as C,aX as _e,aY as M,aZ as E,a_ as ke,aS as F,aD as he,r as g,a0 as Pe,c as y,a as i,d as t,g as b,o as v,aT as k,f as Ne,F as h,H as we,I as xe}from"./index-B9WMAgPp.js";import{f as z}from"./formatDate-l4zQ4D13.js";import{s as N}from"./index-BAUH0ml_.js";import"./index-uurWoLOS.js";import"./index-DsYEzwOE.js";import"./index-C7xObSHm.js";import"./index-nszv79N2.js";import"./index-DWLvmoye.js";import"./index-BEpbll0U.js";import"./index-D3XgYTZ0.js";import"./index-D_BTokr3.js";import"./index-CqPY98u6.js";import"./index-D2QTpbNw.js";import"./index-DRcKLDty.js";import"./index-BbQFmVAV.js";import"./index-DOZc9ZBs.js";import"./index-Bpy52-VE.js";import"./index-CkapM4k5.js";import"./index-Bx8IZfT9.js";import"./index-Dcgh8jvp.js";const S="/admin-profiles",Ie=(a="all",u="all",r="",n=1,c=10,w="")=>D.get(`${S}${r?`?search=${r}&`:"?"}page=${n}&limit=${c}&status=${a}&profile_type=${u}&profile_id=${w}`).then(f=>f.data),Te=a=>D.post(`${S}`,a).then(u=>u.data),Ve=(a,u,r)=>D.put(`${S}/${a}?profile_id=${r}`,u).then(n=>n.data),$e=(a,u)=>D.delete(`${S}/${a}?profile_id=${u}`).then(r=>r.data);function De(a){return a==="admin"?"Администратор":a==="moderator"?"Модератор":a==="supporter"?"Спонсор":a==="employee"?"Сотрудник":"Неизвестно"}function Ce(a){return a==="actived"?"Активный":a==="inactive"?"Неактивный":a==="blocked"?"Заблокирован":"Неизвестно"}function Se(a,u,r,n,c){const w=C();return _e({queryKey:["admin-profiles"],queryFn:()=>Ie(a,u,r,n,c,w.profileID),placeholderData:ke,staleTime:5*60*1e3,cacheTime:5*60*1e3,select:f=>f&&f.documents&&f.documents.length>0?f.documents.map(d=>({createdAt:z(d.created_at),updatedAt:z(d.updated_at),accountId:d.account_id,creatorId:d.creator_id,phone:d.phone,profileType:De(d.profile_type),avatar:d.avatar_id,firstName:d.first_name,lastName:d.last_name,city:d.city,id:d._id,status:Ce(d.status)})):null})}function Ae(a={}){const u=M();return E({mutationFn:r=>Te(r),onSuccess:(r,n)=>{u.invalidateQueries({queryKey:["admin-profiles"],exact:!0}),a.onSuccess&&a.onSuccess(r,n)},onError:(r,n)=>{a.onError&&a.onError(r,n)}})}function Ue(a={}){const u=M(),r=C();return E({mutationFn:({id:n,accountData:c})=>Ve(n,c,r.profileID),onSuccess:(n,c)=>{u.invalidateQueries({queryKey:["admin-profiles"],exact:!0}),a.onSuccess&&a.onSuccess(n,c)},onError:(n,c)=>{a.onError&&a.onError(n,c)}})}function qe(a={}){const u=M(),r=C();return E({mutationFn:n=>$e(n,r.profileID),onSuccess:()=>{u.invalidateQueries({queryKey:["admin-profiles"],exact:!0}),a.onSuccess&&a.onSuccess()},onError:(n,c)=>{a.onError&&a.onError(n,c)}})}const Le={class:"card"},Fe={class:"flex flex-wrap gap-2 items-center justify-between"},Me={key:1,class:"flex items-center justify-center size-10 bg-gray-200 rounded-full"},Ee={class:"flex flex-col gap-6"},Re={key:0},Ke={key:0,class:"text-red-500"},Oe=["src"],Qe={key:0,class:"text-red-500"},Be={key:0,class:"text-red-500"},je={key:0,class:"text-red-500"},ze={key:0,class:"text-red-500"},He={key:0,class:"text-red-500"},We={key:0,class:"text-red-500"},Xe={class:"flex items-center gap-4"},Il={__name:"AdminProfiles",setup(a){const u=C(),{data:r,isLoading:n,error:c}=Se("all"),w=F(()=>(r==null?void 0:r.value)||[]),f=he(),R=g(),d=g(!1),x=g(!1),A=g({global:{value:null,matchMode:Pe.CONTAINS}}),U=g(null),I=g(!1),K=g([{name:"Админ",code:"admin"},{name:"Модератор",code:"moderator"},{name:"Спонсор",code:"supporter"},{name:"Сотрудник",code:"employee"}]),l=g({firstName:"",lastName:"",phone:"",city:"",accountId:"",profileType:""}),V=g(null);function H(s){V.value=s.files[0].objectURL,f.add({severity:"info",summary:"Успех",detail:"Файлы загружены",life:3e3})}const O=F(()=>{const s=l.value.phone;return typeof s=="string"?parseInt(s.replace(/\D/g,"")):s}),{mutate:W,isPending:X}=Ae({onSuccess:()=>{f.add({severity:"success",summary:"Успех",detail:"Профиль успешно создан",life:3e3}),$()},onError:s=>{f.add({severity:"error",summary:"Ошибка",detail:"Не удалось создать профиль",life:3e3})}}),{mutate:Y}=Ue({onSuccess:()=>{f.add({severity:"success",summary:"Успех",detail:"Профиль успешно обновлен",life:3e3}),$()},onError:s=>{f.add({severity:"error",summary:"Ошибка",detail:"Не удалось обновить профиль",life:3e3})}}),{data:q}=ge(),Q=F(()=>{var s;return(s=q==null?void 0:q.value)==null?void 0:s.map(e=>({name:e.phone,code:e.id}))});function Z(){m.value=!0,I.value?Y({id:l.value.id,accountData:{phone:O.value,profile_type:l.value.profileType.code,first_name:l.value.firstName,status:"actived",last_name:l.value.lastName,city:l.value.city}}):W({profile_id:u.profileID,phone:O.value,profile_type:l.value.profileType.code,account_id:l.value.accountId.code,first_name:l.value.firstName,last_name:l.value.lastName,city:l.value.city})}const m=g(!1);function G(){I.value=!1,l.value={firstName:"",lastName:"",phone:"",city:"",accountId:"",profileType:""},V.value=null,m.value=!1,d.value=!0}function $(){d.value=!1,x.value=!1,m.value=!1}function J(s){var _;I.value=!0;const e=(_=Q.value)==null?void 0:_.find(T=>T.code===s.accountId);let P="";s.profileType==="Администратор"?P="admin":s.profileType==="Модератор"?P="moderator":s.profileType==="Спонсор"?P="supporter":s.profileType==="Сотрудник"&&(P="employee");const L=K.value.find(T=>T.code===P)||{name:s.profileType,code:P};l.value={...s,accountId:e,profileType:L},d.value=!0}function ee(s){U.value=s.id,x.value=!0}const{mutate:le,isPending:te}=qe({onSuccess:()=>{f.add({severity:"success",summary:"Успех",detail:"Профиль успешно удален",life:3e3}),$()},onError:s=>{f.add({severity:"error",summary:"Ошибка",detail:"Не удалось удалить профиль",life:3e3})}});function ae(){le(U.value)}return(s,e)=>{const P=be,L=ve,_=ye,T=ce,oe=pe,p=fe,ie=me,re=ue,B=de,j=ne;return v(),y("div",null,[i("div",Le,[t(P,{class:"mb-6"},{end:b(()=>[t(k(N),{label:"Добавить",icon:"pi pi-plus",severity:"secondary",class:"mr-2",onClick:G})]),_:1}),t(ie,{ref_key:"dt",ref:R,value:w.value,stripedRows:"",dataKey:"id",paginator:!0,rows:10,filters:A.value,paginatorTemplate:"FirstPageLink PrevPageLink PageLinks NextPageLink LastPageLink CurrentPageReport RowsPerPageDropdown",rowsPerPageOptions:[5,10,25],currentPageReportTemplate:"{first} до {last} из {totalRecords} элементов"},{header:b(()=>[i("div",Fe,[e[12]||(e[12]=i("h4",{class:"m-0"},"Профили (ПУ)",-1)),t(T,null,{default:b(()=>[t(L,null,{default:b(()=>e[11]||(e[11]=[i("i",{class:"pi pi-search"},null,-1)])),_:1}),t(_,{modelValue:A.value.global.value,"onUpdate:modelValue":e[0]||(e[0]=o=>A.value.global.value=o),placeholder:"Поиск"},null,8,["modelValue"])]),_:1})])]),default:b(()=>[t(p,{field:"avatar",header:"Аватар",sortable:"",style:{"min-width":"8rem"}},{body:b(o=>[o.data.avatar?(v(),Ne(oe,{key:0,image:o.data.avatar,shape:"circle"},null,8,["image"])):(v(),y("div",Me,e[13]||(e[13]=[i("i",{class:"pi pi-user"},null,-1)])))]),_:1}),t(p,{field:"accountId",header:"Аккаунт (ID)",sortable:"",style:{"min-width":"12rem"}}),t(p,{field:"creatorId",header:"Создатель (ID)",sortable:"",style:{"min-width":"12rem"}}),t(p,{field:"phone",header:"Телефон",sortable:"",style:{"min-width":"12rem"}}),t(p,{field:"firstName",header:"Имя",sortable:"",style:{"min-width":"8rem"}}),t(p,{field:"lastName",header:"Фамилия",sortable:"",style:{"min-width":"10rem"}}),t(p,{field:"city",header:"Город",sortable:"",style:{"min-width":"10rem"}}),t(p,{field:"status",header:"Статус",sortable:"",style:{"min-width":"10rem"}}),t(p,{field:"profileType",header:"Роль",style:{"min-width":"10rem"}}),t(p,{field:"id",header:"ID профиля",sortable:"",style:{"min-width":"16rem"}}),t(p,{field:"createdAt",header:"Дата создания",sortable:"",style:{"min-width":"12rem"}}),t(p,{field:"updatedAt",header:"Дата обновления",sortable:"",style:{"min-width":"12rem"}}),t(p,{exportable:!1,style:{"min-width":"12rem"}},{body:b(o=>[t(k(N),{icon:"pi pi-pencil",outlined:"",rounded:"",class:"mr-2",onClick:se=>J(o.data)},null,8,["onClick"]),t(k(N),{icon:"pi pi-trash",outlined:"",rounded:"",severity:"danger",onClick:se=>ee(o.data)},null,8,["onClick"])]),_:1})]),_:1},8,["value","filters"])]),t(j,{visible:d.value,"onUpdate:visible":e[8]||(e[8]=o=>d.value=o),style:{width:"450px"},header:I.value?"Редактирование профиля (ПУ)":"Добавление профиля (ПУ)",modal:!0},{footer:b(()=>[t(k(N),{label:"Отменить",icon:"pi pi-times",text:"",onClick:$}),t(k(N),{label:"Сохранить",icon:"pi pi-check",onClick:Z,loading:k(X)},null,8,["loading"])]),default:b(()=>[i("div",Ee,[I.value?(v(),y("div",Re,[e[14]||(e[14]=i("label",{for:"name",class:"block font-bold mb-3"},"ID",-1)),t(_,{id:"id",modelValue:l.value.id,"onUpdate:modelValue":e[1]||(e[1]=o=>l.value.id=o),modelModifiers:{trim:!0},required:"true",autofocus:"",invalid:m.value&&!l.value.id,fluid:"",disabled:""},null,8,["modelValue","invalid"]),m.value&&!l.value.id?(v(),y("small",Ke,"Обязательное поле")):h("",!0)])):h("",!0),i("div",null,[e[15]||(e[15]=i("div",{class:"block font-bold mb-3"},"Аватар",-1)),t(re,{mode:"basic",onSelect:H,customUpload:"",auto:"",severity:"secondary",class:"p-button-outlined",chooseLabel:"Выбрать"}),V.value?(v(),y("img",{key:0,src:V.value,alt:"Image",class:"shadow-md rounded-xl w-full size-40 sm:w-64 mt-4"},null,8,Oe)):h("",!0)]),i("div",null,[e[16]||(e[16]=i("label",{for:"firstName",class:"block font-bold mb-3"},"Имя",-1)),t(_,{id:"firstName",modelValue:l.value.firstName,"onUpdate:modelValue":e[2]||(e[2]=o=>l.value.firstName=o),modelModifiers:{trim:!0},required:"true",autofocus:"",invalid:m.value&&!l.value.firstName,fluid:""},null,8,["modelValue","invalid"]),m.value&&!l.value.firstName?(v(),y("small",Qe,"Обязательное поле")):h("",!0)]),i("div",null,[e[17]||(e[17]=i("label",{for:"lastName",class:"block font-bold mb-3"},"Фамилия",-1)),t(_,{id:"lastName",modelValue:l.value.lastName,"onUpdate:modelValue":e[3]||(e[3]=o=>l.value.lastName=o),modelModifiers:{trim:!0},required:"true",autofocus:"",invalid:m.value&&!l.value.lastName,fluid:""},null,8,["modelValue","invalid"]),m.value&&!l.value.lastName?(v(),y("small",Be,"Обязательное поле")):h("",!0)]),i("div",null,[e[18]||(e[18]=i("label",{for:"name",class:"block font-bold mb-3"},"Телефон",-1)),t(_,{id:"phone",modelValue:l.value.phone,"onUpdate:modelValue":e[4]||(e[4]=o=>l.value.phone=o),modelModifiers:{trim:!0},required:"true",autofocus:"",invalid:m.value&&!l.value.phone,fluid:""},null,8,["modelValue","invalid"]),m.value&&!l.value.phone?(v(),y("small",je,"Обязательное поле")):h("",!0)]),i("div",null,[e[19]||(e[19]=i("label",{for:"city",class:"block font-bold mb-3"},"Город",-1)),t(_,{id:"city",modelValue:l.value.city,"onUpdate:modelValue":e[5]||(e[5]=o=>l.value.city=o),modelModifiers:{trim:!0},required:"true",autofocus:"",invalid:m.value&&!l.value.city,fluid:""},null,8,["modelValue","invalid"]),m.value&&!l.value.city?(v(),y("small",ze,"Обязательное поле")):h("",!0)]),i("div",null,[e[20]||(e[20]=i("div",{class:"block font-bold mb-3"},"Тип профиля",-1)),t(B,{modelValue:l.value.profileType,"onUpdate:modelValue":e[6]||(e[6]=o=>l.value.profileType=o),options:K.value,optionLabel:"name",placeholder:"Тип профиля",class:"w-full",invalid:m.value&&!l.value.profileType},null,8,["modelValue","options","invalid"]),m.value&&!l.value.profileType?(v(),y("small",He,"Обязательное поле")):h("",!0)]),i("div",null,[e[21]||(e[21]=i("div",{class:"block font-bold mb-3"}," Аккаунт, к которому привязан профиль ",-1)),t(B,{modelValue:l.value.accountId,"onUpdate:modelValue":e[7]||(e[7]=o=>l.value.accountId=o),options:Q.value,optionLabel:"name",placeholder:"Аккаунт (ID)",class:"w-full",invalid:m.value&&!l.value.profileType},null,8,["modelValue","options","invalid"]),m.value&&!l.value.profileType?(v(),y("small",We,"Обязательное поле")):h("",!0)])])]),_:1},8,["visible","header"]),t(j,{visible:x.value,"onUpdate:visible":e[10]||(e[10]=o=>x.value=o),style:{width:"450px"},header:"Подтверждение",modal:!0},{footer:b(()=>[t(k(N),{label:"Нет",icon:"pi pi-times",text:"",onClick:e[9]||(e[9]=o=>x.value=!1)}),t(k(N),{label:"Да",icon:"pi pi-check",onClick:ae,loading:k(te)},null,8,["loading"])]),default:b(()=>[i("div",Xe,[e[22]||(e[22]=i("i",{class:"pi pi-exclamation-triangle !text-3xl"},null,-1)),we(" Вы уверены, что хотите удалить профиль c id "+xe(U.value)+"? ",1)])]),_:1},8,["visible"])])}}};export{Il as default};
