import{s as q}from"./index-DPCV2Ee5.js";import{s as E}from"./index-BITpGhP1.js";import{s as K}from"./index-BTML_cXl.js";import{s as Q}from"./index-CGhCaLS4.js";import{s as W}from"./index-Dlue8Cix.js";import{s as H,a as Z}from"./index-BPJ3xovF.js";import{s as z}from"./index-DC1oGjXQ.js";import{aV as G,aQ as V,aW as J,aZ as X,aR as Y,aD as ee,r as p,a0 as te,c as g,a as s,d as e,g as r,aS as c,o as _,I as N,F as T}from"./index-z1uXvXEi.js";import{f as C}from"./formatDate-l4zQ4D13.js";import{s as v}from"./index-DYBcNESa.js";import"./index-DFvs91Rb.js";import"./index-DR_CA7HW.js";import"./index-ibAaKPa9.js";import"./index-1vWsUMNt.js";import"./index-BoxnDY_1.js";import"./index-BYMwb912.js";import"./index-57ubhNbJ.js";import"./index-BXRqlT2O.js";import"./index-DWl0dXX8.js";import"./index-Bw8snGY9.js";import"./index-Sl98z5SM.js";import"./index-BpAzr15_.js";import"./index-dXz3bja4.js";import"./index-DX0VtpCH.js";import"./index-DxE9uxNC.js";const le="/offers",ae=(w="all",h="all",n="",b=1,k=10,y="")=>G.get(`${le}${n?`?search=${n}&`:"?"}page=${b}&limit=${k}&status=${w}&profile_type=${h}&profile_id=${y}`).then(d=>d.data);function oe(w,h,n,b,k){const y=V();return J({queryKey:["offers"],queryFn:()=>ae(w,h,n,b,k,y.profileID),placeholderData:X,staleTime:5*60*1e3,cacheTime:5*60*1e3,select:d=>d&&d.documents&&d.documents.length>0?d.documents.map(a=>({id:a._id,images:a.images,video:a.video,title:a.title,subcategoryId:a.subcategory_id,price:a.price,description:a.description,location:a.location,offerStatus:a.status,promotion:a.promotion_info,profile:a.profile,createdAt:C(a.created_at),updatedAt:C(a.updated_at)})):null})}const ie={class:"card"},se={class:"flex flex-wrap gap-2 items-center justify-between"},re={key:0,class:"p-4"},ne={key:1},de={class:"flex flex-col gap-6"},pe={key:0,class:"text-red-500"},ue={class:"text-right"},me={key:0,class:"text-red-500"},Me={__name:"Offers",setup(w){const h=V(),{data:n,isLoading:b,error:k}=oe("all"),y=Y(()=>(n==null?void 0:n.value)||[]);ee();const d=p(),u=p(!1),a=p(!1),x=p({global:{value:null,matchMode:te.CONTAINS}}),L=p([{name:"Активный",code:"active"},{name:"Неактивный",code:"inactive"},{name:"Заблокирован",code:"blocked"}]),o=p({firstName:"",lastName:"",phone:"",city:"",accountId:"",profileType:""});function I(){m.value=!0,createProfile({profile_id:h.profileID,phone:numericPhone.value,profile_type:o.value.profileType.code,account_id:o.value.accountId.code,first_name:o.value.firstName,last_name:o.value.lastName,city:o.value.city})}const m=p(!1);function S(f){o.value={firstName:"",lastName:"",phone:"",city:"",accountId:f.data.accountId,profileType:""},m.value=!1,u.value=!0}const O=p({});function R(f){a.value=!0,O.value=f}function P(){u.value=!1,a.value=!1,m.value=!1}function A(f){R(f.data)}return(f,t)=>{const U=Z,F=z,M=H,l=W,$=Q,B=K,j=E,D=q;return _(),g("div",null,[s("div",ie,[e($,{ref_key:"dt",ref:d,value:y.value,stripedRows:"",dataKey:"id",paginator:!0,rows:10,filters:x.value,paginatorTemplate:"FirstPageLink PrevPageLink PageLinks NextPageLink LastPageLink CurrentPageReport RowsPerPageDropdown",rowsPerPageOptions:[5,10,25],currentPageReportTemplate:"{first} до {last} из {totalRecords} элементов",rowHover:!0,onRowClick:A,selectionMode:"single",loading:c(b)},{header:r(()=>[s("div",se,[t[6]||(t[6]=s("h4",{class:"m-0"},"Предложения",-1)),e(M,null,{default:r(()=>[e(U,null,{default:r(()=>t[5]||(t[5]=[s("i",{class:"pi pi-search"},null,-1)])),_:1}),e(F,{modelValue:x.value.global.value,"onUpdate:modelValue":t[0]||(t[0]=i=>x.value.global.value=i),placeholder:"Поиск"},null,8,["modelValue"])]),_:1})])]),expansion:r(i=>[i.data.partner?(_(),g("div",re,[s("h5",null," Информация о партнере "+N(i.data.partner.short_name),1),e($,{value:i.data.partner},{default:r(()=>[e(l,{field:"short_name",header:"Краткое название",sortable:""}),e(l,{field:"full_name",header:"Полное название",sortable:""}),e(l,{field:"phone",header:"Телефон",sortable:""}),e(l,{field:"city",header:"Город",sortable:""}),e(l,{field:"email",header:"Email",sortable:""}),e(l,{field:"whatsapp",header:"Whatsapp",sortable:""}),e(l,{field:"telegram",header:"Telegram",sortable:""}),e(l,{field:"inn",header:"ИНН",sortable:""}),e(l,{headerStyle:"width:4rem"},{body:r(()=>[e(c(v),{icon:"pi pi-search"})]),_:1})]),_:2},1032,["value"])])):(_(),g("div",ne,t[7]||(t[7]=[s("h5",null,"Информация о партнере отсутствует",-1)])))]),empty:r(()=>t[8]||(t[8]=[s("div",{class:"flex items-center justify-center"},[s("div",{class:"text-gray-500 text-lg py-8"}," Нет данных для отображения ")],-1)])),default:r(()=>[e(l,{expander:"",style:{width:"5rem"}}),e(l,{field:"ID",header:"id",sortable:"",style:{"min-width":"12rem"}}),e(l,{field:"title",header:"Название",sortable:"",style:{"min-width":"12rem"}}),e(l,{field:"description",header:"Описание",sortable:"",style:{"min-width":"12rem"}}),e(l,{field:"subcategoryId",header:"Подкатегория",sortable:"",style:{"min-width":"12rem"}}),e(l,{field:"Стоимость",header:"price",sortable:"",style:{"min-width":"8rem"}}),e(l,{field:"offerStatus",header:"Статус",sortable:"",style:{"min-width":"10rem"}}),e(l,{field:"createdAt",header:"Дата создания",sortable:"",style:{"min-width":"12rem"}}),e(l,{field:"updatedAt",header:"Дата обновления",sortable:"",style:{"min-width":"12rem"}}),e(l,{exportable:!1,style:{"min-width":"12rem"}},{body:r(i=>[e(c(v),{icon:"pi pi-file-edit",class:"mr-2",outlined:"",label:"Модерирование",severity:"help",onClick:ce=>S(i)},null,8,["onClick"])]),_:1})]),_:1},8,["value","filters","loading"])]),e(D,{visible:u.value,"onUpdate:visible":t[3]||(t[3]=i=>u.value=i),style:{width:"450px"},header:"Модерирование профиля (МП)",modal:!0},{footer:r(()=>[e(c(v),{label:"Отменить",icon:"pi pi-times",text:"",onClick:P}),e(c(v),{label:"Сохранить",icon:"pi pi-check",onClick:I})]),default:r(()=>[s("div",de,[s("div",null,[t[9]||(t[9]=s("div",{class:"block font-bold mb-3"},"Статус профиля",-1)),e(B,{modelValue:o.value.status,"onUpdate:modelValue":t[1]||(t[1]=i=>o.value.status=i),options:L.value,optionLabel:"name",placeholder:"Выберите статус",class:"w-full",invalid:m.value&&!o.value.status},null,8,["modelValue","options","invalid"]),m.value&&!o.value.status?(_(),g("small",pe,"Обязательное поле")):T("",!0)]),s("div",null,[t[10]||(t[10]=s("div",{class:"block font-bold mb-3"},"Комментарий модератора",-1)),e(j,{modelValue:o.value.comment,"onUpdate:modelValue":t[2]||(t[2]=i=>o.value.comment=i),placeholder:"Комментарий",class:"w-full",invalid:m.value&&!o.value.comment},null,8,["modelValue","invalid"]),s("p",ue,N(o.value.comment.length)+" / 30",1),m.value&&!o.value.comment?(_(),g("small",me,"Обязательное поле. Минимум 30 символов")):T("",!0)])])]),_:1},8,["visible"]),e(D,{visible:u.value,"onUpdate:visible":t[4]||(t[4]=i=>u.value=i),style:{width:"850px"},header:"Детальная информация",modal:!0},{footer:r(()=>[e(c(v),{label:"Отменить",icon:"pi pi-times",text:"",onClick:P}),e(c(v),{label:"Сохранить",icon:"pi pi-check",onClick:I})]),default:r(()=>[t[11]||(t[11]=s("div",{class:"flex flex-col gap-6"},"TODO: Детальная информация",-1))]),_:1},8,["visible"])])}}};export{Me as default};
