import{s as W}from"./index-CIEqmJiy.js";import{s as X}from"./index-BJb2w8Xr.js";import{s as Y}from"./index-4fOzUgMh.js";import{s as Z}from"./index-SgKG7yg9.js";import{s as ee}from"./index-BTHKcqVe.js";import{s as te}from"./index-oEje9OwY.js";import{s as ae}from"./index-ClmWJ8Ql.js";import{s as se}from"./index-5B64Yr3S.js";import{s as oe,a as le}from"./index-DiuPxqIt.js";import{s as ie}from"./index-sGnuCcFG.js";import{aV as C,aQ as L,aW as ne,aX as re,aY as de,aZ as me,aR as ue,aD as pe,r as c,a0 as ce,c as m,a,d as s,g as r,aS as b,o as d,I as x,G as fe,J as ve,f as _e,F as V}from"./index-2t5m_B8U.js";import{f as S}from"./formatDate-l4zQ4D13.js";import{s as $}from"./index-BaljtHQq.js";import"./index-CYXz2DcT.js";import"./index-BikcCgXV.js";import"./index-CxhJ11wg.js";import"./index-BMU5YOwo.js";import"./index-DPEEpFT8.js";import"./index-C01u9b3T.js";import"./index-rz7XOXGG.js";import"./index-CmIjS8jF.js";import"./index-CmW33vwP.js";import"./index-DWvw7VAr.js";import"./index--rAq6gtP.js";import"./index-CDm_ImpW.js";import"./index-BhExmjrM.js";import"./index-FUaIQbcE.js";import"./index-hgfqQAcA.js";import"./index-_2NOxF1M.js";const N="/reviews",ge=(i="all",u="all",o="",p=1,h=10,y="")=>C.get(`${N}${o?`?search=${o}&`:"?"}page=${p}&limit=${h}&status=${i}&profile_type=${u}&profile_id=${y}`).then(f=>f.data),ye=(i,u)=>C.post(`${N}/${i}`,u).then(o=>o.data);function xe(i){switch(i){case"verified":return"Подтвержден"}}function he(i,u,o,p,h){const y=L();return ne({queryKey:["reviews"],queryFn:()=>ge(i,u,o,p,h,y.profileID),placeholderData:me,staleTime:5*60*1e3,cacheTime:5*60*1e3,select:f=>f&&f.documents&&f.documents.length>0?f.documents.map(n=>({id:n._id,grade:n.grade,attachments:n.attachments,text:n.text,reviewStatus:xe(n.status),profile:n.profile,createdAt:S(n.created_at),updatedAt:S(n.updated_at),replies:n.replies})):null})}function we(i={}){const u=re();return de({mutationFn:o=>ye(o.id,o.moderationData),onSuccess:(o,p)=>{u.invalidateQueries({queryKey:["reviews"],exact:!0}),i.onSuccess&&i.onSuccess(o,p)},onError:(o,p)=>{i.onError&&i.onError(o,p)}})}const be={class:"card"},ke={class:"flex flex-wrap gap-2 items-center justify-between"},$e={key:0},Re={key:1},Ie={class:"p-4"},De={class:"flex gap-x-20 items-start"},Ve={key:0},Se={class:"mb-2"},Ce={class:"mb-2"},Le={class:"flex gap-x-2 mb-2"},Ne={class:"mb-2"},Te={key:1,class:"text-lg"},Ae={key:2,class:"grow"},Fe={class:"flex gap-6 items-start flex-wrap"},Me={key:3,class:"text-lg"},Pe={class:"flex flex-col gap-6"},Ue={key:0,class:"text-red-500"},Ee={class:"text-right"},Be={key:0,class:"text-red-500"},_t={__name:"Reviews",setup(i){const u=L(),{data:o,isLoading:p}=he("all"),h=ue(()=>(o==null?void 0:o.value)||[]),y=pe(),f=c(),w=c(!1),n=c(!1),k=c({global:{value:null,matchMode:ce.CONTAINS}}),T=c([{name:"Подтвержден",code:"verified"},{name:"Заблокирован",code:"blocked"}]),l=c({firstName:"",lastName:"",phone:"",city:"",accountId:"",profileType:""}),{mutate:A}=we({onSuccess:()=>{y.add({severity:"success",summary:"Успех",detail:"Отзыв подтвержден",life:3e3}),R()},onError:v=>{y.add({severity:"error",summary:"Ошибка",detail:"Не удалось подтвердить отзыв",life:3e3})}});function F(){g.value=!0,A({id:l.value.id,moderationData:{profile_id:u.profileID,status:l.value.status.code,moderation_comment:l.value.comment}})}const g=c(!1);function M(v){l.value={firstName:"",lastName:"",phone:"",city:"",accountId:v.data.accountId,profileType:"",id:v.data.id},g.value=!1,w.value=!0}const P=c({});function U(v){n.value=!0,P.value=v}function R(){w.value=!1,n.value=!1,g.value=!1}function E(v){U(v.data)}const I=c([]);return(v,e)=>{const B=le,O=ie,Q=oe,_=se,q=ae,K=te,j=ee,z=Z,G=Y,H=X,J=W;return d(),m("div",null,[a("div",be,[s(z,{"expanded-rows":I.value,"onUpdate:expandedRows":e[1]||(e[1]=t=>I.value=t),ref_key:"dt",ref:f,value:h.value,stripedRows:"",dataKey:"id",paginator:!0,rows:10,filters:k.value,paginatorTemplate:"FirstPageLink PrevPageLink PageLinks NextPageLink LastPageLink CurrentPageReport RowsPerPageDropdown",rowsPerPageOptions:[5,10,25],currentPageReportTemplate:"{first} до {last} из {totalRecords} элементов",rowHover:!0,onRowClick:E,selectionMode:"single",loading:b(p)},{header:r(()=>[a("div",ke,[e[6]||(e[6]=a("h4",{class:"m-0"},"Отзывы",-1)),s(Q,null,{default:r(()=>[s(B,null,{default:r(()=>e[5]||(e[5]=[a("i",{class:"pi pi-search"},null,-1)])),_:1}),s(O,{modelValue:k.value.global.value,"onUpdate:modelValue":e[0]||(e[0]=t=>k.value.global.value=t),placeholder:"Поиск"},null,8,["modelValue"])]),_:1})])]),expansion:r(t=>[a("div",Ie,[e[10]||(e[10]=a("h5",null,"Детальная информация",-1)),a("div",De,[t.data.profile?(d(),m("div",Ve,[e[8]||(e[8]=a("div",{class:"text-lg"},"Автор:",-1)),a("span",Se,"Имя: "+x(t.data.profile.first_name),1),a("span",Ce,"Фамилия: "+x(t.data.profile.last_name??"Отсутвует"),1),a("div",Le,[e[7]||(e[7]=a("span",null,"Аватар",-1)),s(K,{image:"https://aidoo-test.ru/api-admin/files/"+t.data.profile.avatar_id||"/layout/images/avatar-placeholder.png",size:"xlarge",shape:"circle"},null,8,["image"])]),a("span",Ne,"Город: "+x(t.data.profile.city??"Отсутвует"),1)])):(d(),m("p",Te,"Информация об авторе отсутсвует")),t.data.attachments?(d(),m("div",Ae,[e[9]||(e[9]=a("div",{class:"font-semibold text-lg mb-4"},"Вложения",-1)),a("div",Fe,[(d(!0),m(fe,null,ve(t.data.attachments,D=>(d(),_e(j,{src:"https://aidoo-test.ru/api-admin/files/"+D,alt:"Image",width:"250"},null,8,["src"]))),256))])])):(d(),m("p",Me,"Вложения отсутствуют"))])])]),empty:r(()=>e[11]||(e[11]=[a("div",{class:"flex items-center justify-center"},[a("div",{class:"text-gray-500 text-lg py-8"}," Нет данных для отображения ")],-1)])),default:r(()=>[s(_,{expander:"",style:{width:"5rem"}}),s(_,{field:"grade",header:"Оценка"},{body:r(t=>[s(q,{modelValue:t.data.grade,readonly:""},null,8,["modelValue"])]),_:1}),s(_,{field:"text",header:"Текст",sortable:"",style:{"min-width":"12rem"}}),s(_,{field:"reviewStatus",header:"Статус",sortable:"",style:{"min-width":"12rem"}}),s(_,{field:"Автор",header:"price",sortable:"",style:{"min-width":"8rem"}},{body:r(t=>[t.data.profile?(d(),m("span",$e,x(t.data.profile.first_name)+" "+x(t.data.profile.last_name),1)):(d(),m("span",Re,"Отсутсвует"))]),_:1}),s(_,{field:"createdAt",header:"Дата создания",sortable:"",style:{"min-width":"12rem"}}),s(_,{field:"updatedAt",header:"Дата обновления",sortable:"",style:{"min-width":"12rem"}}),s(_,{exportable:!1,style:{"min-width":"12rem"}},{body:r(t=>[s(b($),{icon:"pi pi-file-edit",outlined:"",label:"Модерирование",severity:"help",onClick:D=>M(t)},null,8,["onClick"])]),_:1})]),_:1},8,["expanded-rows","value","filters","loading"])]),s(J,{visible:w.value,"onUpdate:visible":e[4]||(e[4]=t=>w.value=t),style:{width:"450px"},header:"Модерирование отзыва",modal:!0},{footer:r(()=>[s(b($),{label:"Отменить",icon:"pi pi-times",text:"",onClick:R}),s(b($),{label:"Сохранить",icon:"pi pi-check",onClick:F})]),default:r(()=>[a("div",Pe,[a("div",null,[e[12]||(e[12]=a("div",{class:"block font-bold mb-3"},"Статус",-1)),s(G,{modelValue:l.value.status,"onUpdate:modelValue":e[2]||(e[2]=t=>l.value.status=t),options:T.value,optionLabel:"name",placeholder:"Выберите статус",class:"w-full",invalid:g.value&&!l.value.status},null,8,["modelValue","options","invalid"]),g.value&&!l.value.status?(d(),m("small",Ue,"Обязательное поле")):V("",!0)]),a("div",null,[e[13]||(e[13]=a("div",{class:"block font-bold mb-3"},"Комментарий модератора",-1)),s(H,{modelValue:l.value.comment,"onUpdate:modelValue":e[3]||(e[3]=t=>l.value.comment=t),placeholder:"Комментарий",class:"w-full",invalid:g.value&&!l.value.comment&&l.value.comment.length>=30},null,8,["modelValue","invalid"]),a("p",Ee,x(l.value.comment.length)+" / 30",1),g.value&&!l.value.comment?(d(),m("small",Be,"Обязательное поле. Минимум 30 символов")):V("",!0)])])]),_:1},8,["visible"])])}}};export{_t as default};
