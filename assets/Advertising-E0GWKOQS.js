import{s as re}from"./index-CIEqmJiy.js";import{s as ne}from"./index-4fOzUgMh.js";import{s as ue}from"./index-DOeC6ywA.js";import{s as de}from"./index-SgKG7yg9.js";import{s as ce}from"./index-5B64Yr3S.js";import{s as me}from"./index-oEje9OwY.js";import{s as pe,a as ve}from"./index-DiuPxqIt.js";import{s as fe}from"./index-sGnuCcFG.js";import{s as ye}from"./index-BvTC_-DX.js";import{u as be}from"./useAdminAccounts-CaC4LbvQ.js";import{aV as A,aQ as V,aW as ke,aX as h,aY as D,aZ as ge,aR as Se,aD as _e,r as v,a0 as xe,c as k,a as n,d as a,g as f,aS as g,o as y,f as we,F as _,H as $e,I as Ae}from"./index-2t5m_B8U.js";import{f as O}from"./formatDate-l4zQ4D13.js";import{s as x}from"./index-BaljtHQq.js";import"./index-CYXz2DcT.js";import"./index-BikcCgXV.js";import"./index-CxhJ11wg.js";import"./index-BMU5YOwo.js";import"./index-DPEEpFT8.js";import"./index-hgfqQAcA.js";import"./index-BzWyo4eB.js";import"./index-BKtdnWU-.js";import"./index-C01u9b3T.js";import"./index-rz7XOXGG.js";import"./index-CmIjS8jF.js";import"./index-CmW33vwP.js";import"./index-DWvw7VAr.js";import"./index--rAq6gtP.js";import"./index-CDm_ImpW.js";import"./index-BhExmjrM.js";import"./index-FUaIQbcE.js";const C="/advertising",Ie=(l="",r=1,i=10,o="")=>A.get(`${C}${l?`?search=${l}&`:"?"}page=${r}&limit=${i}&profile_id=${o}`).then(p=>p.data),Te=l=>A.post(`${C}`,l).then(r=>r.data),Ve=(l,r,i)=>A.put(`${C}/${l}?profile_id=${i}`,r).then(o=>o.data),he=(l,r)=>A.delete(`${C}/${l}?profile_id=${r}`).then(i=>i.data);function De(l){return l==="actived"?"Реклама активна":"Реклама отключена"}function Ce(l){switch(l){case"internal":return"Внутренняя";case"external":return"Внешняя";default:return l}}function Pe(l){switch(l){case"offer":return"Объявление от Партнера";case"external":return"Ссылка на внешнего Рекламодателя";case"video":return"Видео реклама";default:return l}}function Ue(l,r,i,o,p){const P=V();return ke({queryKey:["advertising"],queryFn:()=>Ie(i,o,p,P.profileID),placeholderData:ge,staleTime:5*60*1e3,cacheTime:5*60*1e3,select:m=>m&&m.documents&&m.documents.length>0?m.documents.map(d=>({createdAt:O(d.created_at),updatedAt:O(d.updated_at),fileId:d.file_id,type:Pe(d.type),link:d.link,linkType:Ce(d.link_type),number:d.number,advStatus:De(d.status),creator:d.creator_id,id:d._id})):null})}function Ee(l={}){const r=h();return D({mutationFn:i=>Te(i),onSuccess:(i,o)=>{r.invalidateQueries({queryKey:["advertising"],exact:!0}),l.onSuccess&&l.onSuccess(i,o)},onError:(i,o)=>{l.onError&&l.onError(i,o)}})}function Le(l={}){const r=h(),i=V();return D({mutationFn:({id:o,accountData:p})=>Ve(o,p,i.profileID),onSuccess:(o,p)=>{r.invalidateQueries({queryKey:["advertising"],exact:!0}),l.onSuccess&&l.onSuccess(o,p)},onError:(o,p)=>{l.onError&&l.onError(o,p)}})}function Fe(l={}){const r=h(),i=V();return D({mutationFn:o=>he(o,i.profileID),onSuccess:()=>{r.invalidateQueries({queryKey:["advertising"],exact:!0}),l.onSuccess&&l.onSuccess()},onError:(o,p)=>{l.onError&&l.onError(o,p)}})}const qe="/files",Ne=l=>A.post(`${qe}`,l).then(r=>r.data);function Re(l={}){const r=h();return D({mutationFn:i=>Ne(i),onSuccess:(i,o)=>{r.invalidateQueries({queryKey:["files"],exact:!0}),l.onSuccess&&l.onSuccess(i,o)},onError:(i,o)=>{l.onError&&l.onError(i,o)}})}const Me={class:"card"},Qe={class:"flex flex-wrap gap-2 items-center justify-between"},Ke={key:1,class:"flex items-center justify-center size-10 bg-gray-200 rounded-full"},Oe={class:"flex flex-col gap-6"},Be={key:0},je={key:0,class:"text-red-500"},ze=["src"],Ye={key:0,class:"text-red-500"},He={key:0,class:"text-red-500"},We={key:0,class:"text-red-500"},Xe={key:0,class:"text-red-500"},Ze={key:0,class:"text-red-500"},Ge={class:"flex items-center gap-4"},Dt={__name:"Advertising",setup(l){const r=V(),{data:i,isLoading:o,error:p}=Ue(),P=Se(()=>(i==null?void 0:i.value)||[]),m=_e(),N=v(),d=v(!1),w=v(!1),U=v({global:{value:null,matchMode:xe.CONTAINS}}),E=v(null),$=v(!1),R=v([{name:"Объявление от Партнера",code:"offer"},{name:"Ссылка на внешнего Рекламодателя",code:"external"},{name:"Видео реклама",code:"video"}]),M=v([{name:"Внутренняя",code:"internal"},{name:"Внешняя",code:"external"}]),Q=v([{name:"Реклама активна",code:"actived"},{name:"Реклама отключена",code:"draft"}]),t=v({}),I=v(null),{mutate:B}=Re({onSuccess:u=>{m.add({severity:"success",summary:"Успех",detail:"Файл загружен успешно",life:3e3}),t.value.fileId=u._id},onError:u=>{m.add({severity:"error",summary:"Ошибка",detail:"Не загрузить файл",life:3e3})}});function j(u){I.value=u.files[0].objectURL;const e=new FormData;e.append("document",u.files[0]),B(e)}const{mutate:z,isPending:Y}=Ee({onSuccess:()=>{m.add({severity:"success",summary:"Успех",detail:"Профиль успешно создан",life:3e3}),T()},onError:u=>{m.add({severity:"error",summary:"Ошибка",detail:"Не удалось создать профиль",life:3e3})}}),{mutate:H}=Le({onSuccess:()=>{m.add({severity:"success",summary:"Успех",detail:"Профиль успешно обновлен",life:3e3}),T()},onError:u=>{m.add({severity:"error",summary:"Ошибка",detail:"Не удалось обновить профиль",life:3e3})}}),{data:Je}=be();function W(){if(c.value=!0,$.value)H({id:t.value.id,accountData:{profile_id:r.profileID,type:t.value.type.code,link:t.value.link,file_id:t.value.fileId,link_type:t.value.linkType.code,number:t.value.number,status:t.value.advStatus.code}});else{const u={profile_id:r.profileID,type:t.value.type.code,link:t.value.link,link_type:t.value.linkType.code,file_id:t.value.fileId,number:t.value.number,status:t.value.advStatus.code};z(u)}}const c=v(!1);function X(){$.value=!1,t.value={},I.value=null,c.value=!1,d.value=!0}function T(){d.value=!1,w.value=!1,c.value=!1}function Z(u){$.value=!0;const e=R.value.find(b=>b.name===u.type),L=M.value.find(b=>b.name===u.linkType),F=Q.value.find(b=>b.name===u.advStatus);t.value={...u,type:e,linkType:L,advStatus:F},console.log(t.value),d.value=!0}function G(u){E.value=u.id,w.value=!0}const{mutate:J,isPending:ee}=Fe({onSuccess:()=>{m.add({severity:"success",summary:"Успех",detail:"Профиль успешно удален",life:3e3}),T()},onError:u=>{m.add({severity:"error",summary:"Ошибка",detail:"Не удалось удалить профиль",life:3e3})}});function te(){J(E.value)}return(u,e)=>{const L=ye,F=ve,b=fe,le=pe,ae=me,S=ce,ie=de,oe=ue,q=ne,K=re;return y(),k("div",null,[n("div",Me,[a(L,{class:"mb-6"},{end:f(()=>[a(g(x),{label:"Добавить",icon:"pi pi-plus",severity:"secondary",class:"mr-2",onClick:X})]),_:1}),a(ie,{ref_key:"dt",ref:N,value:P.value,stripedRows:"",dataKey:"id",paginator:!0,rows:10,filters:U.value,paginatorTemplate:"FirstPageLink PrevPageLink PageLinks NextPageLink LastPageLink CurrentPageReport RowsPerPageDropdown",rowsPerPageOptions:[5,10,25],currentPageReportTemplate:"{first} до {last} из {totalRecords} элементов",loading:g(o)},{header:f(()=>[n("div",Qe,[e[11]||(e[11]=n("h4",{class:"m-0"},"Реклама",-1)),a(le,null,{default:f(()=>[a(F,null,{default:f(()=>e[10]||(e[10]=[n("i",{class:"pi pi-search"},null,-1)])),_:1}),a(b,{modelValue:U.value.global.value,"onUpdate:modelValue":e[0]||(e[0]=s=>U.value.global.value=s),placeholder:"Поиск"},null,8,["modelValue"])]),_:1})])]),default:f(()=>[a(S,{field:"fileId",header:"Файл",sortable:"",style:{"min-width":"8rem"}},{body:f(s=>[s?(y(),we(ae,{key:0,image:"https://aidoo-test.ru/api-admin/files/"+s.data.fileId,shape:"circle"},null,8,["image"])):(y(),k("div",Ke,e[12]||(e[12]=[n("i",{class:"pi pi-user"},null,-1)])))]),_:1}),a(S,{field:"type",header:"Тип рекламы",sortable:"",style:{"min-width":"12rem"}}),a(S,{field:"link",header:"Ссылка",sortable:"",style:{"min-width":"12rem"}}),a(S,{field:"linkType",header:"Тип ссылки",sortable:"",style:{"min-width":"12rem"}}),a(S,{field:"number",header:"Номер",sortable:"",style:{"min-width":"8rem"}}),a(S,{field:"advStatus",header:"Активность",sortable:"",style:{"min-width":"10rem"}}),a(S,{field:"id",header:"ID профиля",sortable:"",style:{"min-width":"16rem"}}),a(S,{field:"createdAt",header:"Дата создания",sortable:"",style:{"min-width":"12rem"}}),a(S,{exportable:!1,style:{"min-width":"12rem"}},{body:f(s=>[a(g(x),{icon:"pi pi-pencil",outlined:"",rounded:"",class:"mr-2",onClick:se=>Z(s.data)},null,8,["onClick"]),a(g(x),{icon:"pi pi-trash",outlined:"",rounded:"",severity:"danger",onClick:se=>G(s.data)},null,8,["onClick"])]),_:1})]),_:1},8,["value","filters","loading"])]),a(K,{visible:d.value,"onUpdate:visible":e[7]||(e[7]=s=>d.value=s),style:{width:"450px"},header:$.value?"Редактирование рекламы":"Добавление рекламы",modal:!0},{footer:f(()=>[a(g(x),{label:"Отменить",icon:"pi pi-times",text:"",onClick:T}),a(g(x),{label:"Сохранить",icon:"pi pi-check",onClick:W,loading:g(Y)},null,8,["loading"])]),default:f(()=>[n("div",Oe,[$.value?(y(),k("div",Be,[e[13]||(e[13]=n("label",{for:"name",class:"block font-bold mb-3"},"ID",-1)),a(b,{id:"id",modelValue:t.value.id,"onUpdate:modelValue":e[1]||(e[1]=s=>t.value.id=s),modelModifiers:{trim:!0},required:"true",autofocus:"",invalid:c.value&&!t.value.id,fluid:"",disabled:""},null,8,["modelValue","invalid"]),c.value&&!t.value.id?(y(),k("small",je,"Обязательное поле")):_("",!0)])):_("",!0),n("div",null,[e[14]||(e[14]=n("div",{class:"block font-bold mb-3"},"Файл",-1)),a(oe,{mode:"basic",onSelect:j,customUpload:"",auto:"",severity:"secondary",class:"p-button-outlined",chooseLabel:"Выбрать"}),I.value||"https://aidoo-test.ru/api-admin/files/"+t.value.fileId?(y(),k("img",{key:0,src:I.value||"https://aidoo-test.ru/api-admin/files/"+t.value.fileId,alt:"Image",class:"shadow-md rounded-xl w-full size-40 sm:w-64 mt-4"},null,8,ze)):_("",!0)]),n("div",null,[e[15]||(e[15]=n("div",{class:"block font-bold mb-3"},"Тип предложения",-1)),a(q,{modelValue:t.value.type,"onUpdate:modelValue":e[2]||(e[2]=s=>t.value.type=s),options:R.value,optionLabel:"name",placeholder:"Выберите тип предложения",class:"w-full",invalid:c.value&&!t.value.type},null,8,["modelValue","options","invalid"]),c.value&&!t.value.type?(y(),k("small",Ye,"Обязательное поле")):_("",!0)]),n("div",null,[e[16]||(e[16]=n("div",{class:"block font-bold mb-3"},"Тип ссылки",-1)),a(q,{modelValue:t.value.linkType,"onUpdate:modelValue":e[3]||(e[3]=s=>t.value.linkType=s),options:M.value,optionLabel:"name",placeholder:"Выберите тип ссылки",class:"w-full",invalid:c.value&&!t.value.linkType},null,8,["modelValue","options","invalid"]),c.value&&!t.value.linkType?(y(),k("small",He,"Обязательное поле")):_("",!0)]),n("div",null,[e[17]||(e[17]=n("label",{for:"firstName",class:"block font-bold mb-3"},"Ссылка",-1)),a(b,{id:"firstName",modelValue:t.value.link,"onUpdate:modelValue":e[4]||(e[4]=s=>t.value.link=s),modelModifiers:{trim:!0},required:"true",autofocus:"",invalid:c.value&&!t.value.link,fluid:""},null,8,["modelValue","invalid"]),c.value&&!t.value.link?(y(),k("small",We,"Обязательное поле")):_("",!0)]),n("div",null,[e[18]||(e[18]=n("label",{for:"name",class:"block font-bold mb-3"},"Номер",-1)),a(b,{id:"phone",modelValue:t.value.number,"onUpdate:modelValue":e[5]||(e[5]=s=>t.value.number=s),modelModifiers:{trim:!0},required:"true",autofocus:"",invalid:c.value&&!t.value.number,fluid:""},null,8,["modelValue","invalid"]),c.value&&!t.value.number?(y(),k("small",Xe,"Обязательное поле")):_("",!0)]),n("div",null,[e[19]||(e[19]=n("div",{class:"block font-bold mb-3"},"Активность",-1)),a(q,{modelValue:t.value.advStatus,"onUpdate:modelValue":e[6]||(e[6]=s=>t.value.advStatus=s),options:Q.value,optionLabel:"name",placeholder:"Активность",class:"w-full",invalid:c.value&&!t.value.advStatus},null,8,["modelValue","options","invalid"]),c.value&&!t.value.advStatus?(y(),k("small",Ze,"Обязательное поле")):_("",!0)])])]),_:1},8,["visible","header"]),a(K,{visible:w.value,"onUpdate:visible":e[9]||(e[9]=s=>w.value=s),style:{width:"450px"},header:"Подтверждение",modal:!0},{footer:f(()=>[a(g(x),{label:"Нет",icon:"pi pi-times",text:"",onClick:e[8]||(e[8]=s=>w.value=!1)}),a(g(x),{label:"Да",icon:"pi pi-check",onClick:te,loading:g(ee)},null,8,["loading"])]),default:f(()=>[n("div",Ge,[e[20]||(e[20]=n("i",{class:"pi pi-exclamation-triangle !text-3xl"},null,-1)),$e(" Вы уверены, что хотите удалить рекламу c id "+Ae(E.value)+"? ",1)])]),_:1},8,["visible"])])}}};export{Dt as default};
