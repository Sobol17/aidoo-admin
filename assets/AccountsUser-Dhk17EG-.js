import{s as O}from"./index-CurXEB00.js";import{s as G}from"./index-B1O_roLE.js";import{s as H}from"./index-C0k0BVDM.js";import{s as W}from"./index-BAUH0ml_.js";import{s as X}from"./index-C-zIenvA.js";import{s as Y,a as Z}from"./index-CRMrgCsE.js";import{s as z}from"./index-BOXa9Jy8.js";import{aW as h,aR as y,aX as J,aY as P,aZ as S,a_ as ee,aS as w,aD as te,r as c,a0 as oe,aE as ae,c as re,a as p,d as t,g as m,G as se,o as ne,H as ie,I as le,aT as ce}from"./index-B9WMAgPp.js";import{f as A}from"./formatDate-l4zQ4D13.js";import"./index-uurWoLOS.js";import"./index-DsYEzwOE.js";import"./index-C7xObSHm.js";import"./index-DWLvmoye.js";import"./index-CqPY98u6.js";import"./index-B5GLnlRG.js";import"./index-nszv79N2.js";import"./index-D2QTpbNw.js";import"./index-DRcKLDty.js";import"./index-BbQFmVAV.js";import"./index-DOZc9ZBs.js";import"./index-Bpy52-VE.js";import"./index-CkapM4k5.js";import"./index-Bx8IZfT9.js";import"./index-Dcgh8jvp.js";import"./index-BEpbll0U.js";const k="/user-accounts",ue=(e="",r=1,s=10,o="")=>h.get(`${k}${e?`?search=${e}&`:"?"}page=${r}&limit=${s}&profile_id=${o}`).then(a=>a.data),de=(e,r,s)=>h.put(`${k}/${e}?profile_id=${s}`,r).then(o=>o.data),pe=(e,r)=>h.delete(`${k}/${e}?profile_id=${r}`).then(s=>s.data);function me(e="",r=1,s=1e3){const o=y();return J({queryKey:["user-accounts"],queryFn:()=>ue(e,r,s,o.profileID),placeholderData:ee,staleTime:5*60*1e3,cacheTime:5*60*1e3,select:a=>a&&a.documents&&a.documents.length>0?a.documents.map(d=>({blocked:d.blocked?"Заблокирован":"Активен",phone:d.phone,createdAt:A(d.created_at),updatedAt:A(d.updated_at),id:d._id})):null})}function fe(e={}){const r=P(),s=y();return S({mutationFn:({id:o,accountData:a})=>de(o,a,s.profileID),onSuccess:(o,a)=>{r.invalidateQueries({queryKey:["user-accounts"],exact:!0}),e.onSuccess&&e.onSuccess(o,a)},onError:(o,a)=>{e.onError&&e.onError(o,a)}})}function ve(e={}){const r=P(),s=y();return S({mutationFn:o=>pe(o,s.profileID),onSuccess:()=>{r.invalidateQueries({queryKey:["user-accounts"],exact:!0}),e.onSuccess&&e.onSuccess()},onError:(o,a)=>{e.onError&&e.onError(o,a)}})}const ge={class:"card"},ye={class:"flex flex-wrap gap-2 items-center justify-between"},be={class:"flex items-center gap-4"},Qe={__name:"AccountsUser",setup(e){y();const{data:r,isLoading:s,error:o}=me(),a=w(()=>(r==null?void 0:r.value)||[]),u=te(),d=c(),I=c(!1),v=c(!1),b=c({global:{value:null,matchMode:oe.CONTAINS}}),_=c(null);c(!1);const L=c({phone:"",password:""});w(()=>parseInt(L.value.phone.replace(/\D/g,"")));const{mutate:D}=fe({onSuccess:()=>{u.add({severity:"success",summary:"Успех",detail:"Аккаунт успешно обновлен",life:3e3}),x()},onError:i=>{u.add({severity:"error",summary:"Ошибка",detail:"Не удалось обновить аккаунт",life:3e3})}}),T=c(!1),$=ae(),E=i=>{$.require({message:"Вы уверены, что хотите заблокировать этот аккаунт?",header:"Подтверждение блокировки",icon:"pi pi-exclamation-triangle",acceptLabel:"Да",rejectLabel:"Нет",acceptClass:"p-button-danger",accept:()=>{D({id:i.id,accountData:{blocked:!0}}),u.add({severity:"info",summary:"Выполнено",detail:"Аккаунт заблокирован",life:3e3})},reject:()=>{}})},U=i=>{$.require({message:"Вы уверены, что хотите разблокировать этот аккаунт?",header:"Подтверждение разблокировки",icon:"pi pi-exclamation-triangle",acceptLabel:"Да",rejectLabel:"Нет",acceptClass:"p-button-danger",accept:()=>{D({id:i.id,accountData:{blocked:!1}}),u.add({severity:"info",summary:"Выполнено",detail:"Аккаунт разблокирован",life:3e3})},reject:()=>{}})};function x(){I.value=!1,v.value=!1,T.value=!1}function q(i){_.value=i.id,v.value=!0}const{mutate:F,isPending:R}=ve({onSuccess:()=>{u.add({severity:"success",summary:"Успех",detail:"Аккаунт успешно удален",life:3e3}),x()},onError:i=>{u.add({severity:"error",summary:"Ошибка",detail:"Не удалось удалить аккаунт",life:3e3})}});function N(){F(_.value)}return(i,n)=>{const V=Z,j=z,B=Y,f=X,g=W,K=H,M=G,Q=O;return ne(),re(se,null,[p("div",null,[p("div",ge,[t(K,{ref_key:"dt",ref:d,value:a.value,stripedRows:"",dataKey:"id",paginator:!0,rows:10,filters:b.value,paginatorTemplate:"FirstPageLink PrevPageLink PageLinks NextPageLink LastPageLink CurrentPageReport RowsPerPageDropdown",rowsPerPageOptions:[5,10,25],currentPageReportTemplate:"{first} до {last} из {totalRecords} элементов"},{header:m(()=>[p("div",ye,[n[4]||(n[4]=p("h4",{class:"m-0"},"Аккаунты (МП)",-1)),t(B,null,{default:m(()=>[t(V,null,{default:m(()=>n[3]||(n[3]=[p("i",{class:"pi pi-search"},null,-1)])),_:1}),t(j,{modelValue:b.value.global.value,"onUpdate:modelValue":n[0]||(n[0]=l=>b.value.global.value=l),placeholder:"Поиск"},null,8,["modelValue"])]),_:1})])]),default:m(()=>[t(f,{field:"id",header:"ID",sortable:"",style:{"min-width":"16rem"}}),t(f,{field:"phone",header:"Телефон",sortable:"",style:{"min-width":"16rem"}}),t(f,{field:"blocked",header:"Блокировка",style:{"min-width":"16rem"}}),t(f,{field:"createdAt",header:"Дата создания",sortable:"",style:{"min-width":"12rem"}}),t(f,{field:"updatedAt",header:"Дата обновления",sortable:"",style:{"min-width":"12rem"}}),t(f,{exportable:!1,style:{"min-width":"12rem"}},{body:m(l=>[t(g,{icon:"pi pi-ban",outlined:"",rounded:"",class:"mr-2",severity:"warn",onClick:C=>E(l.data)},null,8,["onClick"]),t(g,{icon:"pi pi-trash",outlined:"",rounded:"",severity:"danger",class:"mr-2",onClick:C=>q(l.data)},null,8,["onClick"]),t(g,{label:"Разблокировать",icon:"pi pi-check",severity:"help",outlined:"",onClick:C=>U(l.data),class:"p-button-lg"},null,8,["onClick"])]),_:1})]),_:1},8,["value","filters"])]),t(M,{visible:v.value,"onUpdate:visible":n[2]||(n[2]=l=>v.value=l),style:{width:"450px"},header:"Подтверждение",modal:!0},{footer:m(()=>[t(g,{label:"Нет",icon:"pi pi-times",text:"",onClick:n[1]||(n[1]=l=>v.value=!1)}),t(g,{label:"Да",icon:"pi pi-check",onClick:N,loading:ce(R)},null,8,["loading"])]),default:m(()=>[p("div",be,[n[5]||(n[5]=p("i",{class:"pi pi-exclamation-triangle !text-3xl"},null,-1)),ie(" Вы уверены, что хотите удалить аккаунт c id "+le(_.value)+"? ",1)])]),_:1},8,["visible"])]),t(Q)],64)}}};export{Qe as default};
