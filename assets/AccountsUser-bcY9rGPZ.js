import{s as G}from"./index-GBU6WChI.js";import{s as H}from"./index-DPCV2Ee5.js";import{s as W}from"./index-CGhCaLS4.js";import{s as X}from"./index-DYBcNESa.js";import{s as Y}from"./index-Dlue8Cix.js";import{s as Z,a as z}from"./index-BPJ3xovF.js";import{s as J}from"./index-DC1oGjXQ.js";import{aV as h,aQ as y,aW as ee,aX as S,aY as I,aZ as te,aR as w,aD as oe,r as c,a0 as ae,aE as re,c as se,a as p,d as t,g as m,aS as A,G as ne,o as ie,H as le,I as ce}from"./index-z1uXvXEi.js";import{f as P}from"./formatDate-l4zQ4D13.js";import"./index-DFvs91Rb.js";import"./index-DR_CA7HW.js";import"./index-ibAaKPa9.js";import"./index-BoxnDY_1.js";import"./index-BYMwb912.js";import"./index-BTML_cXl.js";import"./index-1vWsUMNt.js";import"./index-57ubhNbJ.js";import"./index-BXRqlT2O.js";import"./index-DWl0dXX8.js";import"./index-Bw8snGY9.js";import"./index-Sl98z5SM.js";import"./index-BpAzr15_.js";import"./index-dXz3bja4.js";import"./index-DX0VtpCH.js";import"./index-DxE9uxNC.js";const k="/user-accounts",ue=(e="",r=1,s=10,o="")=>h.get(`${k}${e?`?search=${e}&`:"?"}page=${r}&limit=${s}&profile_id=${o}`).then(a=>a.data),de=(e,r,s)=>h.put(`${k}/${e}?profile_id=${s}`,r).then(o=>o.data),pe=(e,r)=>h.delete(`${k}/${e}?profile_id=${r}`).then(s=>s.data);function me(e="",r=1,s=1e3){const o=y();return ee({queryKey:["user-accounts"],queryFn:()=>ue(e,r,s,o.profileID),placeholderData:te,staleTime:5*60*1e3,cacheTime:5*60*1e3,select:a=>a&&a.documents&&a.documents.length>0?a.documents.map(d=>({blocked:d.blocked?"Заблокирован":"Активен",phone:d.phone,createdAt:P(d.created_at),updatedAt:P(d.updated_at),id:d._id})):null})}function fe(e={}){const r=S(),s=y();return I({mutationFn:({id:o,accountData:a})=>de(o,a,s.profileID),onSuccess:(o,a)=>{r.invalidateQueries({queryKey:["user-accounts"],exact:!0}),e.onSuccess&&e.onSuccess(o,a)},onError:(o,a)=>{e.onError&&e.onError(o,a)}})}function ge(e={}){const r=S(),s=y();return I({mutationFn:o=>pe(o,s.profileID),onSuccess:()=>{r.invalidateQueries({queryKey:["user-accounts"],exact:!0}),e.onSuccess&&e.onSuccess()},onError:(o,a)=>{e.onError&&e.onError(o,a)}})}const ve={class:"card"},ye={class:"flex flex-wrap gap-2 items-center justify-between"},be={class:"flex items-center gap-4"},Me={__name:"AccountsUser",setup(e){y();const{data:r,isLoading:s,error:o}=me(),a=w(()=>(r==null?void 0:r.value)||[]),u=oe(),d=c(),L=c(!1),g=c(!1),b=c({global:{value:null,matchMode:ae.CONTAINS}}),_=c(null);c(!1);const E=c({phone:"",password:""});w(()=>parseInt(E.value.phone.replace(/\D/g,"")));const{mutate:D}=fe({onSuccess:()=>{u.add({severity:"success",summary:"Успех",detail:"Аккаунт успешно обновлен",life:3e3}),x()},onError:i=>{u.add({severity:"error",summary:"Ошибка",detail:"Не удалось обновить аккаунт",life:3e3})}}),T=c(!1),$=re(),U=i=>{$.require({message:"Вы уверены, что хотите заблокировать этот аккаунт?",header:"Подтверждение блокировки",icon:"pi pi-exclamation-triangle",acceptLabel:"Да",rejectLabel:"Нет",acceptClass:"p-button-danger",accept:()=>{D({id:i.id,accountData:{blocked:!0}}),u.add({severity:"info",summary:"Выполнено",detail:"Аккаунт заблокирован",life:3e3})},reject:()=>{}})},q=i=>{$.require({message:"Вы уверены, что хотите разблокировать этот аккаунт?",header:"Подтверждение разблокировки",icon:"pi pi-exclamation-triangle",acceptLabel:"Да",rejectLabel:"Нет",acceptClass:"p-button-danger",accept:()=>{D({id:i.id,accountData:{blocked:!1}}),u.add({severity:"info",summary:"Выполнено",detail:"Аккаунт разблокирован",life:3e3})},reject:()=>{}})};function x(){L.value=!1,g.value=!1,T.value=!1}function F(i){_.value=i.id,g.value=!0}const{mutate:R,isPending:V}=ge({onSuccess:()=>{u.add({severity:"success",summary:"Успех",detail:"Аккаунт успешно удален",life:3e3}),x()},onError:i=>{u.add({severity:"error",summary:"Ошибка",detail:"Не удалось удалить аккаунт",life:3e3})}});function N(){R(_.value)}return(i,n)=>{const j=z,B=J,Q=Z,f=Y,v=X,K=W,M=H,O=G;return ie(),se(ne,null,[p("div",null,[p("div",ve,[t(K,{ref_key:"dt",ref:d,value:a.value,stripedRows:"",dataKey:"id",paginator:!0,rows:10,filters:b.value,paginatorTemplate:"FirstPageLink PrevPageLink PageLinks NextPageLink LastPageLink CurrentPageReport RowsPerPageDropdown",rowsPerPageOptions:[5,10,25],currentPageReportTemplate:"{first} до {last} из {totalRecords} элементов",loading:A(s)},{header:m(()=>[p("div",ye,[n[4]||(n[4]=p("h4",{class:"m-0"},"Аккаунты (МП)",-1)),t(Q,null,{default:m(()=>[t(j,null,{default:m(()=>n[3]||(n[3]=[p("i",{class:"pi pi-search"},null,-1)])),_:1}),t(B,{modelValue:b.value.global.value,"onUpdate:modelValue":n[0]||(n[0]=l=>b.value.global.value=l),placeholder:"Поиск"},null,8,["modelValue"])]),_:1})])]),default:m(()=>[t(f,{field:"id",header:"ID",sortable:"",style:{"min-width":"16rem"}}),t(f,{field:"phone",header:"Телефон",sortable:"",style:{"min-width":"16rem"}}),t(f,{field:"blocked",header:"Блокировка",style:{"min-width":"16rem"}}),t(f,{field:"createdAt",header:"Дата создания",sortable:"",style:{"min-width":"12rem"}}),t(f,{field:"updatedAt",header:"Дата обновления",sortable:"",style:{"min-width":"12rem"}}),t(f,{exportable:!1,style:{"min-width":"12rem"}},{body:m(l=>[t(v,{icon:"pi pi-ban",outlined:"",rounded:"",class:"mr-2",severity:"warn",onClick:C=>U(l.data)},null,8,["onClick"]),t(v,{icon:"pi pi-trash",outlined:"",rounded:"",severity:"danger",class:"mr-2",onClick:C=>F(l.data)},null,8,["onClick"]),t(v,{label:"Разблокировать",icon:"pi pi-check",severity:"help",outlined:"",onClick:C=>q(l.data),class:"p-button-lg"},null,8,["onClick"])]),_:1})]),_:1},8,["value","filters","loading"])]),t(M,{visible:g.value,"onUpdate:visible":n[2]||(n[2]=l=>g.value=l),style:{width:"450px"},header:"Подтверждение",modal:!0},{footer:m(()=>[t(v,{label:"Нет",icon:"pi pi-times",text:"",onClick:n[1]||(n[1]=l=>g.value=!1)}),t(v,{label:"Да",icon:"pi pi-check",onClick:N,loading:A(V)},null,8,["loading"])]),default:m(()=>[p("div",be,[n[5]||(n[5]=p("i",{class:"pi pi-exclamation-triangle !text-3xl"},null,-1)),le(" Вы уверены, что хотите удалить аккаунт c id "+ce(_.value)+"? ",1)])]),_:1},8,["visible"])]),t(O)],64)}}};export{Me as default};
